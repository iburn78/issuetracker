{% extends "board/base.html" %}
{% block style %}
<style>
  .th-img-style {
    height: 150px;
    width: 150px;
    object-fit: cover;
    overflow: hidden;
    border-radius: 8px;
    margin-top: 4px;
    margin-bottom: 2px;
  }
  
  .align-top {
    display: flex;
    align-items: top;
  }
</style>
{% endblock style %}

{% block content %}
{% load crispy_forms_tags %}
{% load static %}
<div class="container-fluid p-0 m-0 bg-gray-200">
  <div class="border-bottom m-0 p-1 py-1 h4" style="background-color: {{ card.card_color }}">
    {% if update %}
    Update post for <b>{{ card.title }}</b>
    {% else %}
    New post for <b>{{ card.title }}</b>
    {% endif %}
    {% if card.is_public %}
    <span class="float-end">(<img src="{% static 'icons/people-fill.svg' %}" width="20" height="20">)</span>
    {% if card.is_official %}
    <span class="float-end me-1"><img src="{% static 'board/IssueTracker_Logo.png' %}" width="24" height="24"></span>
    {% endif %}
    {% endif %}
  </div>
  <form method="POST" class="p-1" enctype="multipart/form-data" autocomplete="off" onsubmit="holdon(event)">
    {% csrf_token %}
    <fieldset>
      <p class="m-0 p-0">Title</p>
      {{ form.title }}
      <p class="m-0 p-0">Content</p>
      {{ form.content }}
      {% if num_images > 0 %}
      <div class="text-muted small">Current images:</div>
      {% endif %}
      <div class="row m-0 p-0 row-cols-auto text-muted small">
        {% for img in image_range %}
        <div class="col m-0 p-0 align-top">
          <i class="bi bi-{{forloop.counter}}-square me-1" width="22" height="22"></i>
          <img src="{{ img.url }}" alt="" class="post-img-update me-1">
        </div>
        {% endfor %} 
      </div>
      <div hidden id="new_img_intro" class="small text-muted">
        {% if update %}
        <hr class="m-0 p-0 mt-1">
        New images:
        {% endif %}
      </div>
      <div class="row m-0 p-0 row-cols-auto text-muted small">
        <div hidden id="image-preview1-div" class="col m-0 p-0 align-top">
          <i class="bi bi-1-square-fill me-1" width="22" height="22"></i><img id="image-preview1" src="" class="th-img-style me-1">
        </div>
        <div hidden id="image-preview2-div" class="col m-0 p-0 align-top">
          <i class="bi bi-2-square-fill me-1" width="22" height="22"></i><img id="image-preview2" src="" class="th-img-style me-1">
        </div>
        <div hidden id="image-preview3-div" class="col m-0 p-0 align-top">
          <i class="bi bi-3-square-fill me-1" width="22" height="22"></i><img id="image-preview3" src="" class="th-img-style me-1">
        </div>
        <div hidden id="image-preview4-div" class="col m-0 p-0 align-top">
          <i class="bi bi-4-square-fill me-1" width="22" height="22"></i><img id="image-preview4" src="" class="th-img-style me-1">
        </div>
        <div hidden id="image-preview5-div" class="col m-0 p-0 align-top">
          <i class="bi bi-5-square-fill me-1" width="22" height="22"></i><img id="image-preview5" src="" class="th-img-style me-1">
        </div>
        <div hidden id="image-preview6-div" class="col m-0 p-0 align-top">
          <i class="bi bi-6-square-fill me-1" width="22" height="22"></i><img id="image-preview6" src="" class="th-img-style me-1">
        </div>
        <div hidden id="image-preview7-div" class="col m-0 p-0 align-top">
          <i class="bi bi-7-square-fill me-1" width="22" height="22"></i><img id="image-preview7" src="" class="th-img-style me-1">
        </div>
      </div>
      
      <input id="image_input1" hidden type="file" name="image1_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview1')" >
      <input id="image_input2" hidden type="file" name="image2_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview2')" >
      <input id="image_input3" hidden type="file" name="image3_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview3')" >
      <input id="image_input4" hidden type="file" name="image4_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview4')" >
      <input id="image_input5" hidden type="file" name="image5_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview5')" >
      <input id="image_input6" hidden type="file" name="image6_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview6')" >
      <input id="image_input7" hidden type="file" name="image7_input" class="form-control" accept="image/*" onchange="updatePreview(this, 'image-preview7')" >
      <p class="m-0 p-0">Images</p>
      <div class="d-flex align-items-center ms-0 m-1">
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 1)">1</button>
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 2)">2</button>
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 3)">3</button>
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 4)">4</button>
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 5)">5</button>
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 6)">6</button>
        <button class="btn btn-sm btn-warning p-1 px-2 me-2 fw-bold" onclick="addimg(event, 7)">7</button>
      </div>
      <p class="m-0 p-0">Tags</p>
      <p class="mb-1 m-0 p-0">{{ form.tags }}</p>
      {% if update %}
      <div class="form-check mb-2">
        <input class="form-check-input" type="checkbox" value="checked" name="update_date_posted" checked>
        update date posted
      </div>
      {% endif %}
      <div id="holdon_area">
        <button id="post-cu-button" class="btn btn-primary btn-sm mb-2 me-1 float-end" type="submit">
          {% if update %}Update{% else %}Create{% endif %}
        </button>
      </div>
      <input type="button" id="post-cu-cancel-button" class="btn btn-outline-secondary btn-sm mb-2" value="cancel" onclick="javascript:history.go(-1);">
    </fieldset>
  </form>
</div>
<script>
  function addimg(event, num) {
    event.preventDefault();
    document.getElementById("image_input"+num.toString()).click();
  }
  
  function updatePreview(input, target) {
    let reader = new FileReader();
    reader.readAsDataURL(input.files[0]);
    reader.onload = function () {
      let img = document.getElementById(target);
      let img_div = document.getElementById(target+"-div");
      let img_intro = document.getElementById('new_img_intro');
      img.src = this.result;
      img_div.removeAttribute('hidden');
      img_intro.removeAttribute('hidden');
    }
  }
  
  function holdon(e) {
    let sbutton = document.getElementById("post-cu-button");
    sbutton.style.display = 'none';
    let cbutton = document.getElementById("post-cu-cancel-button");
    cbutton.value = "go back"
    submit1();
  }; 
  
  function submit1() {
    document.getElementById("holdon_area").innerHTML = 
    `
    <div class="mb-2 me-2 small text-muted float-end">
    </div>
    `
    setTimeout(submit2, 1000);
  }
  
  function submit2() {
    document.getElementById("holdon_area").innerHTML = 
    `
    <div class="mb-2 me-2 small text-muted float-end">
      submitting...
    </div>
    `
    setTimeout(submit1, 3000);
  }
  
  
</script>
{% endblock content %}